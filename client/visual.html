<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Session: </title>
    <style>
      .iframe-container {
        position: relative;
      }

      .iframe-blocker {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0);
        z-index: 1;
      }

      #iframe {
        width: 100%;
        height: 1000px;
        border: none;
      }

      .mouse {
        position: absolute;
        z-index: 2;
        pointer-events: none;
        width: 20px;
        height: auto;
      }
    </style>
  </head>
  <body>
    <div class="iframe-container">
      <iframe id="iframe"></iframe>
      <div class="iframe-blocker"></div>
      <img src="assets/mouse.png" alt="Mouse" class="mouse" style="display:none;" id="mouseImage"/>
    </div>
    <script>
      const ws = new WebSocket('ws://localhost:3000');

      async function loadDom(data) {
        const html = data;
        const iframe = document.getElementById('iframe');
        iframe.srcdoc = html;
      }

      function setMouse(x, y) {
        const mouseImage = document.getElementById('mouseImage');
        mouseImage.style.left = `${x}px`;
        mouseImage.style.top = `${y}px`;
        mouseImage.style.display = 'block';
      }

      ws.onmessage = (event) => {
        const message = JSON.parse(event.data);
        if (message.writeDom) {
          loadDom(message.writeDom.data);
        } else if (message.setMouse) {
          const { x, y } = message.setMouse;
          setMouse(x, y);
        }
      };
    </script>
  </body>
</html>